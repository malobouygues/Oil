# WTI Options Pricer (Black76 + SABR)

Vanilla options pricer on WTI futures using Black76, with a SABR (Hagan lognormal) volatility smile calibration.

## What it does
- Prices calls/puts on futures with Black76
- Computes Black76 implied vols from market premiums
- Calibrates SABR parameters *(α, ρ, ν)* with β fixed (desk practice)
- Uses a unified vol API: any object providing `vol(T, K)` can feed the pricer

## Model choice (short)
WTI options are options on futures, so the standard model is Black-76:

\[
PV = df \cdot cp \cdot \left(F N(cp\,d_1) - K N(cp\,d_2)\right)
\]
\[
d_1=\frac{\ln(F/K)+\frac12\sigma^2T}{\sigma\sqrt{T}},\quad d_2=d_1-\sigma\sqrt{T}
\]

## SABR (smile model)
SABR produces a smooth parametric implied-vol smile via Hagan's approximation:

- α: ATM vol level  
- ρ: skew driver  
- ν: curvature / vol-of-vol  
- β: fixed to stabilize calibration

SABR implied volatility surface (3D)
The figure below shows the SABR implied volatility surface as a function of:
maturity 
T
T
moneyness 
K
/
F
(
T
)
K/F(T)

<img width="638" height="477" alt="Image" src="https://github.com/user-attachments/assets/b9807fe1-4500-493d-87b1-b1d693aced7b" />

This surface is generated by evaluating the calibrated SABR model and is used directly by the pricer.

## Repo structure
- `pricer.py` – model-agnostic pricer (consumes `vol(T,K)` or a float)
- `src/models/black76.py` – Black76 formula
- `src/models/greeks.py` – delta/gamma/vega (Black76)
- `src/models/implied_vol.py` – implied vol solver (bisection)
- `src/market/forward_curve.py` – WTI forward curve from futures quotes
- `src/market/option_chain.py` – loads option premiums and builds implied-vol smile
- `src/sabr/` – SABR parameters, Hagan formula, calibration
- `src/surfaces/sabr_surface.py` – SABR volatility surface `vol(T,K)`

## Quick sanity check (single expiry)
Below is a repricing check on a near-ATM option: market premium ≈ model PV, and greeks are produced.

```text
AS_OF=2026-02-11 EXPIRY=2026-03-20 T=0.101370 F=64.8100
SABR converged=True rmse=0.0324074112107856
Params: SABRParams(alpha=0.37321338302085155, beta=1.0, rho=0.4379003993560103, nu=3.0863889425562765, shift=0.0)

TEST: call K=65.0000
Market premium: 3.210000
Model PV:       3.213799
Greeks: {'delta': 0.5163603670420965, 'gamma': 0.04811035597219339, 'vega': 8.225098755152635}
```
